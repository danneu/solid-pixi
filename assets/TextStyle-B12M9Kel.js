import{C as d,E as k,d as g,v as p}from"./index-CyjbRZys.js";import{G as s,t as S,a as _,F as f,b as w}from"./GraphicsContext-Cq8oT6sH.js";const c=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function m(i){const t=[];let e=0;for(let r=0;r<c.length;r++){const l=`_${c[r]}`;t[e++]=i[l]}return e=W(i._fill,t,e),e=F(i._stroke,t,e),e=x(i.dropShadow,t,e),t.join("-")}function W(i,t,e){var r;return i&&(t[e++]=i.color,t[e++]=i.alpha,t[e++]=(r=i.fill)==null?void 0:r.styleKey),e}function F(i,t,e){return i&&(e=W(i,t,e),t[e++]=i.width,t[e++]=i.alignment,t[e++]=i.cap,t[e++]=i.join,t[e++]=i.miterLimit),e}function x(i,t,e){return i&&(t[e++]=i.alpha,t[e++]=i.angle,t[e++]=i.blur,t[e++]=i.distance,t[e++]=d.shared.setValue(i.color).toNumber()),e}const u=class n extends k{constructor(t={}){super(),b(t);const e={...n.defaultTextStyle,...t};for(const r in e){const l=r;this[l]=e[r]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...n.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...n.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...s.defaultFillStyle,...t},()=>{this._fill=S({...this._originalFill},s.defaultFillStyle)})),this._fill=S(t===0?"black":t,s.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...s.defaultStrokeStyle,...t},()=>{this._stroke=_({...this._originalStroke},s.defaultStrokeStyle)})),this._stroke=_(t,s.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=m(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=n.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new n({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var r,l,a,h;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const o=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(r=this._fill)!=null&&r.texture&&this._fill.texture.destroy(o),(l=this._originalFill)!=null&&l.texture&&this._originalFill.texture.destroy(o),(a=this._stroke)!=null&&a.texture&&this._stroke.texture.destroy(o),(h=this._originalStroke)!=null&&h.texture&&this._originalStroke.texture.destroy(o)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(r,l,a)=>(r[l]=a,e==null||e(l,a),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(d.isColorLike(t)||t instanceof f||t instanceof w)}};u.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};u.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let y=u;function b(i){const t=i;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=y.defaultDropShadow;i.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){g(p,"strokeThickness is now a part of stroke");const e=t.stroke;let r={};if(d.isColorLike(e))r.color=e;else if(e instanceof f||e instanceof w)r.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))r=e;else throw new Error("Invalid stroke value.");i.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){g(p,"gradient fill is now a fill pattern: `new FillGradient(...)`");let e;i.fontSize==null?i.fontSize=y.defaultTextStyle.fontSize:typeof i.fontSize=="string"?e=parseInt(i.fontSize,10):e=i.fontSize;const r=new f({start:{x:0,y:0},end:{x:0,y:(e||0)*1.7}}),l=t.fillGradientStops.map(a=>d.shared.setValue(a).toNumber());l.forEach((a,h)=>{const o=h/(l.length-1);r.addColorStop(o,a)}),i.fill={fill:r}}}export{y as T,m as g};
